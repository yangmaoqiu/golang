name: Build for LoongArch64

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  workflow_dispatch:

jobs:
  build-loong64:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Go
      uses: actions/setup-go@v5
      with:
        go-version: '1.22'
        
    - name: Initialize Go module (ä¿®å¤ç¼ºå°‘go.mod)
      run: |
        # æ£€æŸ¥æ˜¯å¦å·²æœ‰ go.mod
        if [ ! -f "go.mod" ]; then
          echo "ğŸ“¦ åˆ›å»º go.mod æ–‡ä»¶..."
          go mod init github.com/yangmaoqiu/golang
        else
          echo "âœ… go.mod å·²å­˜åœ¨"
        fi
        
        # æ˜¾ç¤ºå½“å‰æ¨¡å—ä¿¡æ¯
        cat go.mod 2>/dev/null || echo "æœªæ‰¾åˆ°go.mod"
        
    - name: Build for LoongArch64
      run: |
        echo "ğŸ› ï¸ ç¼–è¯‘é¾™èŠ¯æ¶æ„ç¨‹åº..."
        GOOS=linux GOARCH=loong64 CGO_ENABLED=0 go build -v -o main-loong64 .
        
        echo "ğŸ“‹ éªŒè¯æ–‡ä»¶:"
        file main-loong64
        
        echo "ğŸ“ æ–‡ä»¶å¤§å°:"
        ls -lh main-loong64
        
    - name: Upload binary
      uses: actions/upload-artifact@v4
      with:
        name: loong64-binary
        path: main-loong64
        retention-days: 7
