name: Build for LoongArch64

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build-loong64:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Go
      uses: actions/setup-go@v5
      with:
        go-version: '1.22'
        
    - name: Build for LoongArch64 (Pure Go)
      run: |
        echo "ðŸ› ï¸ ç¼–è¯‘é¾™èŠ¯æž¶æž„ç¨‹åº..."
        GOOS=linux GOARCH=loong64 CGO_ENABLED=0 go build -v -o main-loong64 .
        
        echo "ðŸ“‹ éªŒè¯æ–‡ä»¶:"
        file main-loong64
        
        echo "ðŸ“ æ–‡ä»¶å¤§å°:"
        ls -lh main-loong64
        
    - name: Upload binary
      uses: actions/upload-artifact@v4
      with:
        name: loong64-binary
        path: main-loong64
        retention-days: 7
        
    - name: Create test script
      run: |
        # åˆ›å»ºæµ‹è¯•è„šæœ¬
        cat > test-loong64.sh << 'EOF'
        echo "=== é¾™èŠ¯ç¨‹åºæµ‹è¯•è„šæœ¬ ==="
        echo "æ–‡ä»¶ä¿¡æ¯:"
        file main-loong64
        echo ""
        echo "ä½¿ç”¨è¯´æ˜Ž:"
        echo "1. å°† main-loong64 å¤åˆ¶åˆ°é¾™èŠ¯ç”µè„‘"
        echo "2. æ·»åŠ æ‰§è¡Œæƒé™: chmod +x main-loong64"
        echo "3. è¿è¡Œ: ./main-loong64"
        EOF
        
    - name: Upload test script
      uses: actions/upload-artifact@v4
      with:
        name: test-script
        path: test-loong64.sh
